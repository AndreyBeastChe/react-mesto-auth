{"ast":null,"code":"import _toConsumableArray from\"/Users/a-chechetkin/Documents/yandex_paktikum/mesto-react/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _slicedToArray from\"/Users/a-chechetkin/Documents/yandex_paktikum/mesto-react/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState}from\"react\";import Header from\"./Header\";import Footer from\"./Footer\";import Main from\"./Main\";import PopupWithForm from\"./PopupWithForm\";import ImagePopup from\"./ImagePopup\";import EditProfilePopup from\"./EditProfilePopup\";import EditAvatarPopup from\"./EditAvatarPopup\";import AddPlacePopup from\"./AddPlacePopup\";import{CurrentUserContext}from\"../context/CurrentUserContext\";import api from\"../utils/api\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(null),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setSelectedCard=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),currentUser=_React$useState10[0],setCurrentUser=_React$useState10[1];var _React$useState11=React.useState([]),_React$useState12=_slicedToArray(_React$useState11,2),cards=_React$useState12[0],setCards=_React$useState12[1];var _React$useState13=React.useState(null),_React$useState14=_slicedToArray(_React$useState13,2),cardDel=_React$useState14[0],setCardDel=_React$useState14[1];React.useEffect(function(){api.getUser().then(function(user){setCurrentUser(user);}).catch(function(err){return console.log(\"Ошибка получения пользователя\"+err);});},[]);React.useEffect(function(){api.gerCards().then(function(cards){setCards(cards.reverse());}).catch(function(err){return console.log(\"Ошибка получения карточек\"+err);});},[]);function handleEditProfileClick(){setIsEditProfilePopupOpen(true);}function handleAddPlaceClick(){setIsAddPlacePopupOpen(true);}function handleEditAvatarClick(){setIsEditAvatarPopupOpen(true);}function handleCardClick(card){setSelectedCard(card);}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsAddPlacePopupOpen(false);setSelectedCard(null);}function handleUpdateUser(user){debugger;api.setUser(user).then(function(newUser){setCurrentUser(newUser);closeAllPopups();}).catch(function(err){return console.log(\"Ошибка измения пользователя\"+err);});}function handleUpdateAvatar(avatar){debugger;api.changeAvatar(avatar).then(function(newAvatar){setCurrentUser(newAvatar);closeAllPopups();}).catch(function(err){return console.log(\"Ошибка измения фото пользователя\"+err);});}function handleAddPlaceSubmit(newCard){api.addCard(newCard).then(function(cardData){setCards([cardData].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.log(\"Ошибка добавления карточки\"+err);});}function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.likeCard(card._id,!isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});});}//доделать + отображение удаления не на всех\nfunction handleCardDelete(evt){api.deleteCard(cardDel._id).then(function(){setCards(function(state){return state.filter(function(c){return c._id!==cardDel._id;});});}).catch(function(err){return console.log(\"\\u041F\\u0440\\u0438 \\u0443\\u0434\\u0430\\u043B\\u0435\\u043D\\u0438\\u0438 \\u043A\\u0430\\u0440\\u0442\\u043E\\u0447\\u043A\\u0438: \".concat(err));});}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(Main,{cards:cards,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onEditAvatar:handleEditAvatarClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleCardDelete}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{onAddPlace:handleAddPlaceSubmit,onClose:closeAllPopups,isOpen:isAddPlacePopupOpen}),/*#__PURE__*/_jsx(ImagePopup,{card:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(Footer,{})]})});}export default App;","map":{"version":3,"sources":["/Users/a-chechetkin/Documents/yandex_paktikum/mesto-react/src/components/App.js"],"names":["React","useState","Header","Footer","Main","PopupWithForm","ImagePopup","EditProfilePopup","EditAvatarPopup","AddPlacePopup","CurrentUserContext","api","App","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","selectedCard","setSelectedCard","currentUser","setCurrentUser","cards","setCards","cardDel","setCardDel","useEffect","getUser","then","user","catch","err","console","log","gerCards","reverse","handleEditProfileClick","handleAddPlaceClick","handleEditAvatarClick","handleCardClick","card","closeAllPopups","handleUpdateUser","setUser","newUser","handleUpdateAvatar","avatar","changeAvatar","newAvatar","handleAddPlaceSubmit","newCard","addCard","cardData","handleCardLike","isLiked","likes","some","i","_id","likeCard","state","map","c","handleCardDelete","evt","deleteCard","filter"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport Header from \"./Header\";\nimport Footer from \"./Footer\";\nimport Main from \"./Main\";\nimport PopupWithForm from \"./PopupWithForm\";\nimport ImagePopup from \"./ImagePopup\";\nimport EditProfilePopup from \"./EditProfilePopup\";\nimport EditAvatarPopup from \"./EditAvatarPopup\";\nimport AddPlacePopup from \"./AddPlacePopup\";\n\nimport { CurrentUserContext } from \"../context/CurrentUserContext\";\nimport api from \"../utils/api\";\n\nfunction App() {\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] =\n    React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] =\n    React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState(null);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  const [cardDel, setCardDel] = React.useState(null);\n\n\n\n  React.useEffect(() => {\n    api\n      .getUser()\n      .then((user) => {\n        setCurrentUser(user);\n      })\n      .catch((err) => console.log(\"Ошибка получения пользователя\" + err));\n  }, []);\n\n  React.useEffect(() => {\n    api\n      .gerCards()\n      .then((cards) => {\n        setCards(cards.reverse());\n      })\n      .catch((err) => console.log(\"Ошибка получения карточек\" + err));\n  }, []);\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpen(true);\n  }\n\n  function handleAddPlaceClick() {\n    setIsAddPlacePopupOpen(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpen(true);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card);\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setSelectedCard(null);\n  }\n\n  function handleUpdateUser(user) {\n    debugger;\n    api\n      .setUser(user)\n      .then((newUser) => {\n        setCurrentUser(newUser);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(\"Ошибка измения пользователя\" + err));\n  }\n\n  function handleUpdateAvatar(avatar) {\n    debugger;\n    api\n      .changeAvatar(avatar)\n      .then((newAvatar) => {\n        setCurrentUser(newAvatar);\n        closeAllPopups();\n      })\n      .catch((err) => console.log(\"Ошибка измения фото пользователя\" + err));\n  }\n\n  function handleAddPlaceSubmit(newCard) {\n    api.addCard(newCard)\n      .then((cardData) => {\n        setCards([cardData, ...cards]); \n        closeAllPopups();\n      })\n      .catch((err) => console.log(\"Ошибка добавления карточки\" + err));\n  }\n\n\n  function handleCardLike(card) {\n    // Снова проверяем, есть ли уже лайк на этой карточке\n    const isLiked = card.likes.some((i) => i._id === currentUser._id);\n\n    // Отправляем запрос в API и получаем обновлённые данные карточки\n    api.likeCard(card._id, !isLiked).then((newCard) => {\n      setCards((state) => state.map((c) => (c._id === card._id ? newCard : c)));\n    });\n  }\n\n\n\n//доделать + отображение удаления не на всех\n  function handleCardDelete(evt) {\n    api.deleteCard(cardDel._id)\n      .then(() => {\n        setCards((state) => state.filter((c) => c._id !== cardDel._id));\n      })\n      .catch(err => console.log(`При удалении карточки: ${err}`))\n  }\n  \n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <div className=\"page\">\n        <Header />\n        <Main\n          cards={cards}\n          onEditProfile={handleEditProfileClick}\n          onAddPlace={handleAddPlaceClick}\n          onEditAvatar={handleEditAvatarClick}\n          onCardClick={handleCardClick}\n          onCardLike={handleCardLike}\n          onCardDelete={handleCardDelete}\n        />\n\n        <EditProfilePopup\n          isOpen={isEditProfilePopupOpen}\n          onClose={closeAllPopups}\n          onUpdateUser={handleUpdateUser}\n        />\n\n        <EditAvatarPopup\n          isOpen={isEditAvatarPopupOpen}\n          onClose={closeAllPopups}\n          onUpdateAvatar={handleUpdateAvatar}\n        />\n\n        <AddPlacePopup\n          onAddPlace={handleAddPlaceSubmit}\n          onClose={closeAllPopups}\n          isOpen={isAddPlacePopupOpen}\n        />\n\n        <ImagePopup card={selectedCard} onClose={closeAllPopups} />\n\n        <Footer />\n      </div>\n    </CurrentUserContext.Provider>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}